// Generated by IcedCoffeeScript 1.3.3e
var Future, Remote, SockJS, Socket, UUID, port;

if (!(window.JSON != null)) window.JSON = require('json3');

SockJS = require('sockjs-client');

UUID = require('uuid');

Future = require('future');

Remote = require('remote');

if (typeof Server !== "undefined" && Server !== null) {
  Socket = new WebSocket("ws://" + window.location.hostname + ":3000");
} else {
  Socket = new SockJS("http://" + window.location.hostname + ":3000/socket");
}

Remote = {};

port = {
  send: function(data) {
    return Socket.send(data);
  }
};

module.exports = function(keys) {
  var connect;
  Remote = RPC(port, {}, keys);
  return (connect = function() {
    Socket.onmessage = function(_arg) {
      var data;
      data = _arg.data;
      return port.recieve(data);
    };
    Socket.onopen = port.open;
    return Socket.onclose = function() {
      port.close();
      return setTimeout(function() {
        Socket = new SockJS("http://" + window.location.hostname + ":3000/socket");
        return connect();
      }, 5000);
    };
  })();
};
